{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "NeoCore Block Schema v2.0",
  "type": "object",
  "oneOf": [
    { "required": ["prompt_template"] },
    { "required": ["body"] }
  ],
  "required": [
    "block_id",
    "label",
    "domain",
    "category",
    "subcategory",
    "molt_type",
    "cantocore",
    "description",
    "tags",
    "display",
    "code_modules",
    "snap_config",
    "merge_behavior",
    "editable_fields"
  ],
  "properties": {
    "block_id": {
      "type": "string",
      "description": "Unique identifier for the block"
    },
    "label": {
      "type": "string",
      "description": "Human-readable name for UI"
    },
    "domain": {
      "type": "string",
      "enum": ["BusinessPlans", "WebApp", "Chatbot"],
      "description": "Top-level domain folder"
    },
    "category": {
      "type": "string",
      "description": "Second-level category folder"
    },
    "subcategory": {
      "type": "string",
      "description": "Third-level subcategory/folder"
    },
    "molt_type": {
      "type": "string",
      "enum": [
        "Primary",
        "Subject",
        "Instruction",
        "Directive",
        "Philosophy",
        "Blueprint",
        "Merge",
        "Trigger",
        "CodeBlock",
        "Off"
      ],
      "description": "UMG semantic block type"
    },
    "cantocore": {
      "type": "string",
      "description": "Low-level routing/merge DSL"
    },
    "description": {
      "type": "string",
      "description": "Brief explanation of block’s purpose"
    },
    "tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Keyword search helpers"
    },
    "prompt_template": {
      "type": "string",
      "description": "Templated prompt text (if used)"
    },
    "body": {
      "type": "array",
      "description": "Structured content payload (if used)",
      "items": {
        "type": "array",
        "minItems": 2,
        "maxItems": 2,
        "items": [
          { "type": "string" },
          {
            "anyOf": [
              { "type": "string" },
              { "type": "number" },
              { "type": "boolean" },
              { "type": "array" },
              { "type": "object" }
            ]
          }
        ]
      }
    },
    "code_modules": {
      "type": "array",
      "description": "Optional code attachments (JS, Python, shell…)",
      "items": {
        "type": "object",
        "required": ["language", "slot", "code"],
        "properties": {
          "language": { "type": "string" },
          "slot":     { "type": "string" },
          "code":     { "type": "string" }
        },
        "additionalProperties": false
      }
    },
    "display": {
      "type": "object",
      "required": ["color", "icon"],
      "properties": {
        "color": { "type": "string" },
        "icon":  { "type": "string" }
      },
      "additionalProperties": false
    },
    "snap_config": {
      "type": "object",
      "properties": {
        "snap_to":  { "type": "array", "items": { "type": "string" } },
        "accepts":  { "type": "array", "items": { "type": "string" } },
        "order":    { "type": "integer" },
        "priority": { "type": "integer" },
        "scope":    { "type": "string" },
        "locked":   { "type": "boolean" }
      },
      "additionalProperties": false
    },
    "merge_behavior": {
      "type": "object",
      "properties": {
        "merge_as":            { "type": "string" },
        "merge_strategy":      { "type": "string" },
        "priority":            { "type": "integer" },
        "conflict_resolution": { "type": "string" },
        "overrides":           { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },
    "editable_fields": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Which keys users can edit in the UI"
    }
  },
  "additionalProperties": false
}
